{"version":3,"sources":["../../../../../../damianwebsite/node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../../../damianwebsite/node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../../../damianwebsite/frontend/app/dashboard/components/HotnessIndicator.tsx","../../../../../../damianwebsite/frontend/app/dashboard/services/scoringService.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","'use client';\n\n/**\n * Hotness Indicator Component\n * Visual representation of lead hotness with hover explanation\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { LeadHotness, HotnessFactor } from '../types';\nimport { getHotnessExplanation } from '../services/scoringService';\n\ninterface HotnessIndicatorProps {\n  hotness: LeadHotness;\n  factors: HotnessFactor[];\n  size?: 'sm' | 'md' | 'lg';\n}\n\nconst hotnessConfig = {\n  hot: {\n    emoji: 'ðŸ”¥',\n    label: 'Hot Lead',\n    bgColor: 'bg-red-50',\n    borderColor: 'border-red-200',\n    textColor: 'text-red-700'\n  },\n  warm: {\n    emoji: 'ðŸŸ¡',\n    label: 'Warm Lead',\n    bgColor: 'bg-yellow-50',\n    borderColor: 'border-yellow-200',\n    textColor: 'text-yellow-700'\n  },\n  cold: {\n    emoji: 'âšª',\n    label: 'Cold Lead',\n    bgColor: 'bg-gray-50',\n    borderColor: 'border-gray-200',\n    textColor: 'text-gray-600'\n  }\n};\n\nconst sizeConfig = {\n  sm: 'text-sm px-2 py-0.5',\n  md: 'text-base px-3 py-1',\n  lg: 'text-lg px-4 py-2'\n};\n\nexport function HotnessIndicator({ hotness, factors, size = 'md' }: HotnessIndicatorProps) {\n  const [showExplanation, setShowExplanation] = useState(false);\n  const [position, setPosition] = useState<'bottom' | 'top'>('bottom');\n  const triggerRef = useRef<HTMLButtonElement>(null);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  \n  const config = hotnessConfig[hotness];\n  \n  // Determine tooltip position based on available space\n  useEffect(() => {\n    if (showExplanation && triggerRef.current) {\n      const rect = triggerRef.current.getBoundingClientRect();\n      const spaceBelow = window.innerHeight - rect.bottom;\n      setPosition(spaceBelow < 200 ? 'top' : 'bottom');\n    }\n  }, [showExplanation]);\n  \n  // Close on outside click\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        tooltipRef.current && \n        !tooltipRef.current.contains(event.target as Node) &&\n        triggerRef.current &&\n        !triggerRef.current.contains(event.target as Node)\n      ) {\n        setShowExplanation(false);\n      }\n    };\n    \n    if (showExplanation) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [showExplanation]);\n  \n  const explanation = getHotnessExplanation(hotness, factors);\n  \n  return (\n    <div className=\"relative inline-block\">\n      <button\n        ref={triggerRef}\n        onClick={() => setShowExplanation(!showExplanation)}\n        onMouseEnter={() => setShowExplanation(true)}\n        onMouseLeave={() => setShowExplanation(false)}\n        className={`\n          inline-flex items-center gap-1.5 rounded-full border\n          ${config.bgColor} ${config.borderColor} ${config.textColor}\n          ${sizeConfig[size]}\n          cursor-help transition-all hover:shadow-sm\n        `}\n        aria-label={`${config.label}: Click for details`}\n      >\n        <span role=\"img\" aria-hidden=\"true\">{config.emoji}</span>\n        <span className=\"font-medium\">{config.label}</span>\n      </button>\n      \n      {showExplanation && (\n        <div\n          ref={tooltipRef}\n          className={`\n            absolute z-50 w-72 p-4 bg-white rounded-lg shadow-lg border border-gray-200\n            ${position === 'bottom' ? 'top-full mt-2' : 'bottom-full mb-2'}\n            left-0\n          `}\n          role=\"tooltip\"\n        >\n          <div className=\"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100\">\n            <span className=\"text-xl\">{config.emoji}</span>\n            <span className={`font-semibold ${config.textColor}`}>{config.label}</span>\n          </div>\n          \n          <p className=\"text-sm text-gray-700 leading-relaxed\">\n            {explanation}\n          </p>\n          \n          {factors.filter(f => f.present).length > 0 && (\n            <div className=\"mt-3 pt-3 border-t border-gray-100\">\n              <p className=\"text-xs font-medium text-gray-500 mb-2\">What we noticed:</p>\n              <ul className=\"space-y-1\">\n                {factors.filter(f => f.present).map((factor, index) => (\n                  <li key={index} className=\"text-xs text-gray-600 flex items-center gap-1.5\">\n                    <span className=\"text-green-500\">âœ“</span>\n                    {factor.name}\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n          \n          <div \n            className={`\n              absolute w-3 h-3 bg-white border-gray-200 transform rotate-45\n              ${position === 'bottom' \n                ? '-top-1.5 left-6 border-l border-t' \n                : '-bottom-1.5 left-6 border-r border-b'\n              }\n            `}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * Compact hotness badge for list views\n */\ninterface HotnessBadgeProps {\n  hotness: LeadHotness;\n}\n\nexport function HotnessBadge({ hotness }: HotnessBadgeProps) {\n  const config = hotnessConfig[hotness];\n  \n  return (\n    <span \n      className={`\n        inline-flex items-center gap-1 text-xs font-medium rounded-full px-2 py-0.5\n        ${config.bgColor} ${config.borderColor} ${config.textColor} border\n      `}\n      title={config.label}\n    >\n      <span role=\"img\" aria-hidden=\"true\">{config.emoji}</span>\n    </span>\n  );\n}\n\nexport default HotnessIndicator;\n","/**\n * Lead Scoring Service\n * Calculates lead hotness based on engagement signals\n * \n * INTERNAL SCORING (never expose numbers to UI):\n * - Pricing inquiry: +30\n * - Availability check: +25\n * - Contact provided: +25\n * - High-intent page: +20\n * - Urgency signal: +15\n * - Repeat visitor: +10\n */\n\nimport { LeadHotness, HotnessFactor, ConversationMessage, LeadSource } from '../types';\n\ninterface ContactInfo {\n  hasEmail: boolean;\n  hasPhone: boolean;\n}\n\n// Internal scoring weights (NEVER expose these to users)\nconst SCORING_WEIGHTS = {\n  PRICING_INQUIRY: 30,\n  AVAILABILITY_CHECK: 25,\n  CONTACT_PROVIDED: 25,\n  HIGH_INTENT_PAGE: 20,\n  URGENCY_SIGNAL: 15,\n  REPEAT_VISITOR: 10\n};\n\n// High-intent pages\nconst HIGH_INTENT_PAGES = ['/pricing', '/contact', '/services', '/starting-a-business'];\n\n// Keywords for detection\nconst PRICING_KEYWORDS = ['price', 'cost', 'pricing', 'how much', 'fee', 'charge', 'rate', 'afford', 'budget', 'investment'];\nconst AVAILABILITY_KEYWORDS = ['available', 'availability', 'when', 'schedule', 'meeting', 'appointment', 'call', 'time slot', 'book'];\nconst URGENCY_KEYWORDS = ['urgent', 'asap', 'immediately', 'today', 'tomorrow', 'quickly', 'soon', 'rush', 'deadline'];\n\n/**\n * Calculate lead score based on engagement signals\n * @returns Internal score (never expose to UI)\n */\nexport function calculateLeadScore(\n  conversation: ConversationMessage[],\n  source: LeadSource,\n  contactInfo: ContactInfo\n): number {\n  let score = 0;\n  \n  const allUserMessages = conversation\n    .filter(m => m.role === 'user')\n    .map(m => m.content.toLowerCase())\n    .join(' ');\n\n  // Check for pricing inquiry\n  if (PRICING_KEYWORDS.some(kw => allUserMessages.includes(kw))) {\n    score += SCORING_WEIGHTS.PRICING_INQUIRY;\n  }\n\n  // Check for availability inquiry\n  if (AVAILABILITY_KEYWORDS.some(kw => allUserMessages.includes(kw))) {\n    score += SCORING_WEIGHTS.AVAILABILITY_CHECK;\n  }\n\n  // Check for contact info provided\n  if (contactInfo.hasEmail || contactInfo.hasPhone) {\n    score += SCORING_WEIGHTS.CONTACT_PROVIDED;\n  }\n\n  // Check for high-intent page\n  if (HIGH_INTENT_PAGES.some(page => source.page.includes(page))) {\n    score += SCORING_WEIGHTS.HIGH_INTENT_PAGE;\n  }\n\n  // Check for urgency signals\n  if (URGENCY_KEYWORDS.some(kw => allUserMessages.includes(kw))) {\n    score += SCORING_WEIGHTS.URGENCY_SIGNAL;\n  }\n\n  return score;\n}\n\n/**\n * Determine hotness level from score\n * Thresholds: Cold < 25, Warm 25-54, Hot >= 55\n */\nexport function determineHotness(score: number): LeadHotness {\n  if (score >= 55) return 'hot';\n  if (score >= 25) return 'warm';\n  return 'cold';\n}\n\n/**\n * Get all hotness factors with presence status\n */\nexport function getHotnessFactors(\n  conversation: ConversationMessage[],\n  source: LeadSource,\n  contactInfo: ContactInfo\n): HotnessFactor[] {\n  const allUserMessages = conversation\n    .filter(m => m.role === 'user')\n    .map(m => m.content.toLowerCase())\n    .join(' ');\n\n  return [\n    {\n      type: 'pricing_inquiry',\n      name: 'Pricing Inquiry',\n      description: 'Asked about pricing or costs',\n      present: PRICING_KEYWORDS.some(kw => allUserMessages.includes(kw))\n    },\n    {\n      type: 'availability_check',\n      name: 'Availability Check',\n      description: 'Inquired about availability or scheduling',\n      present: AVAILABILITY_KEYWORDS.some(kw => allUserMessages.includes(kw))\n    },\n    {\n      type: 'contact_provided',\n      name: 'Contact Provided',\n      description: 'Provided contact information',\n      present: contactInfo.hasEmail || contactInfo.hasPhone\n    },\n    {\n      type: 'high_intent_page',\n      name: 'High-Intent Page',\n      description: 'Visited from a high-intent page',\n      present: HIGH_INTENT_PAGES.some(page => source.page.includes(page))\n    },\n    {\n      type: 'urgency_signal',\n      name: 'Urgency Signal',\n      description: 'Expressed urgency or time sensitivity',\n      present: URGENCY_KEYWORDS.some(kw => allUserMessages.includes(kw))\n    }\n  ];\n}\n\n/**\n * Get human-readable explanation for hotness level\n * CRITICAL: Never include numeric scores - returns string only\n */\nexport function getHotnessExplanation(\n  hotness: LeadHotness,\n  factors: HotnessFactor[]\n): string {\n  const presentFactors = factors.filter(f => f.present);\n  \n  const explanations = {\n    hot: 'This person is highly engaged and showing strong buying signals. They are ready to take action and should be contacted promptly.',\n    warm: 'This person is interested and exploring their options. They need a bit more information or nurturing before committing.',\n    cold: 'This person is in early research mode or may not be a strong fit. They haven\\'t shown strong buying signals yet.'\n  };\n\n  let explanation = explanations[hotness];\n  \n  if (presentFactors.length > 0) {\n    const factorNames = presentFactors.map(f => f.name || f.description).join(', ');\n    explanation += ` We noticed: ${factorNames}.`;\n  }\n  \n  return explanation;\n}\n\n/**\n * Get detailed explanation object (for extended UI)\n */\nexport function getDetailedHotnessExplanation(\n  hotness: LeadHotness,\n  factors: HotnessFactor[]\n): { title: string; meaning: string; reasons: string[]; recommendations: string } {\n  const presentFactors = factors.filter(f => f.present);\n  const reasons = presentFactors.map(f => f.description || f.name);\n\n  const explanations = {\n    hot: {\n      title: 'ðŸ”¥ Hot Lead',\n      meaning: 'This person is highly engaged and showing strong buying signals. They are ready to take action and should be contacted promptly.',\n      recommendations: 'Reach out within 24 hours. Prepare specific answers to their questions and have availability ready to offer.'\n    },\n    warm: {\n      title: 'ðŸŸ¡ Warm Lead',\n      meaning: 'This person is interested and exploring their options. They need a bit more information or nurturing before committing.',\n      recommendations: 'Follow up with helpful information. Answer their questions thoroughly and offer a no-pressure consultation.'\n    },\n    cold: {\n      title: 'âšª Cold Lead',\n      meaning: 'This person is in early research mode or may not be a strong fit. They haven\\'t shown strong buying signals yet.',\n      recommendations: 'Keep them informed with general updates. Don\\'t push for immediate action but stay available.'\n    }\n  };\n\n  return {\n    title: explanations[hotness].title,\n    meaning: explanations[hotness].meaning,\n    reasons: reasons.length > 0 ? reasons : ['No strong engagement signals detected yet'],\n    recommendations: explanations[hotness].recommendations\n  };\n}\n\n/**\n * Full lead scoring pipeline\n */\nexport function scoreLead(\n  conversation: ConversationMessage[],\n  source: LeadSource,\n  email: string | null,\n  phone: string | null\n): { hotness: LeadHotness; factors: HotnessFactor[] } {\n  const contactInfo = {\n    hasEmail: !!email,\n    hasPhone: !!phone\n  };\n\n  const factors = getHotnessFactors(conversation, source, contactInfo);\n  const score = calculateLeadScore(conversation, source, contactInfo);\n  const hotness = determineHotness(score);\n\n  return { hotness, factors };\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1]}